# B站音乐播放器插件

## 1. 项目介绍

B站音乐播放器插件是一款专为B站用户设计的浏览器插件，旨在提供便捷的音频收藏与播放功能。通过该插件，用户可以轻松收藏B站视频中的音频，并在独立的播放器页面中管理和播放这些音频。

PS：即把b站当成一个音乐平台来使用。

### 核心功能

1. **音频收藏**：
   - 检测B站视频页面，提供一键收藏音频的功能。
   - 支持将音频收藏到默认歌单或自定义歌单。

2. **播放器页面**：
   - 提供独立的播放器页面，支持歌单管理、音频播放控制等功能。
   - 支持播放模式切换、播放速度调整、进度跳转等高级播放功能。

3. **歌单管理**：
   - 支持创建、编辑、删除和排序歌单。
   - 提供音频信息编辑、搜索和批量操作功能。

4. **界面个性化**：
   - 支持主题切换、布局调整和多种视图模式。
   - 提供快捷访问和键盘快捷键支持。

### 技术架构

插件采用模块化设计，主要包括以下核心部分：

- **后台脚本**：负责插件的核心逻辑和数据存储。
- **内容脚本**：注入到B站页面中，实现与页面的交互。
- **弹出页面**：提供快速访问和控制功能。
- **播放器页面**：实现完整的音频播放和管理功能。

通过消息传递机制，各模块之间实现高效通信，确保数据一致性和功能协同。

### 使用技术
- javascript
- html
- css

## 2. 项目结构

```
bilibili-music-player/
├── manifest.json              // 插件配置文件
├── background/                // 后台脚本
│   ├── background.js          // 后台主脚本
│   └── crawler.js             // 音频爬虫逻辑
├── content/                   // 内容脚本
│   └── content.js             // 页面交互主脚本
├── popup/                     // 弹出页面
│   ├── popup.html             // 弹出页面HTML
│   ├── popup.js               // 弹出页面脚本
│   └── popup.css              // 弹出页面样式
├── player/                    // 播放器主页面
│   ├── player.html            // 播放器页面HTML
│   ├── player.js              // 播放器逻辑
│   ├── player.css             // 播放器样式
│   ├── components/            // 组件
│   │   ├── playlist.js        // 歌单组件
│   │   ├── audio-player.js    // 音频播放器组件
│   │   └── song-item.js       // 歌曲项组件
│   └── utils/                 // 工具函数
│       ├── storage.js         // 存储相关
│       └── audio-processor.js // 音频处理
├── assets/                    // 静态资源
│   ├── icons/                 // 图标
│   └── images/                // 图片
└── lib/                       // 第三方库
    └── howler.js              // 音频播放库
```

## 3. 功能描述

### 3.1 核心功能

1. **B站视频音频收藏**
   - 检测当前页面是否为B站视频页面，显示收藏按钮
   - 点击收藏按钮弹出Popper层，提供收藏选项
   - 一键收藏到默认歌单或指定其他歌单
   - 收藏成功后提供视觉反馈和快速进入播放器的选项

2. **播放器主页面**
   - 独立的播放器页面，可通过插件图标或收藏后跳转进入
   - 左侧显示歌单导航，中间显示歌曲列表，底部为播放控制栏
   - 提供完整的音乐播放体验和歌单管理功能
   - 支持各种播放控制和个性化设置

3. **歌单管理系统**
   - 默认「未归类」歌单，存储快速收藏的音频
   - 创建、编辑、删除和排序自定义歌单
   - 歌曲在歌单间移动和复制
   - 为歌单添加封面、描述和标签

4. **音频播放功能**
   - 流式播放B站视频音频，无需完全下载
   - 支持基本控制：播放/暂停、上一首/下一首、音量调节
   - 高级播放控制：播放模式切换、播放速度调整、进度跳转
   - 支持播放队列管理和播放历史记录

5. **音频管理功能**
   - 编辑音频信息（标题、UP主、封面）
   - 高效搜索和筛选功能
   - 批量操作（删除、移动到其他歌单）
   - 音频元数据展示和编辑

### 3.2 扩展功能

1. **快捷访问与控制**
   - 插件图标点击显示Popup页面，提供快速访问
   - Popup页面显示当前播放状态和简易控制
   - 状态展示：当前页面是否为B站视频、是否已收藏
   - 快速进入播放器或执行收藏操作

2. **数据管理与同步**
   - 使用IndexedDB存储音频元数据和播放信息
   - 支持歌单和设置的导入/导出功能
   - 数据备份和恢复功能
   - 可选的云同步功能（需用户授权）

3. **界面个性化**
   - 主题切换：浅色/深色模式，支持跟随系统设置
   - 自定义颜色方案和视觉风格
   - 可调整布局和组件大小
   - 多种视图模式（列表/网格/紧凑）

4. **高级播放体验**
   - 音频可视化效果，多种视觉风格可选
   - 定时停止播放功能，支持睡眠模式
   - 键盘快捷键支持，提升操作效率
   - 可选的桌面通知，显示当前播放信息

## 4. 实现思路

### 4.0 整体架构设计

浏览器插件架构采用模块化设计，主要分为以下几个核心部分：

1. **Background Script（后台脚本）**：作为整个插件的核心控制中心，常驻后台运行
2. **Content Script（内容脚本）**：注入到B站页面中，实现与页面的交互，监控是否为视频页面
3. **Popup Page（弹出页面）**：用户点击插件图标时显示的简易控制面板，提供快速入口
4. **Player Page（播放器页面）**：插件的主界面，提供完整的音乐播放器功能和歌单管理
5. **Storage System（存储系统）**：管理音频数据和用户配置信息

#### 模块间通信机制

插件各模块之间通过Chrome Extension API提供的消息传递机制进行通信：

1. **Background与Content之间**：
   - Content Script通过`chrome.runtime.sendMessage()`向Background发送消息
   - Background通过`chrome.tabs.sendMessage()`向特定标签页的Content Script发送消息
   - 双方使用`chrome.runtime.onMessage.addListener()`监听接收消息

2. **Background与Popup/Player之间**：
   - Popup/Player通过`chrome.runtime.sendMessage()`向Background发送消息
   - Background通过`chrome.runtime.onMessage.addListener()`监听并回应
   - 也可通过共享的IndexedDB间接通信

3. **长连接通信**：
   - 对于需要持续通信的场景（如音频播放状态同步），使用`chrome.runtime.connect()`建立长连接
   - 通过`port.postMessage()`和`port.onMessage.addListener()`进行双向通信

4. **广播机制**：
   - 使用`chrome.runtime.sendMessage()`不指定接收者ID时，消息会广播给所有监听者
   - 适用于状态更新（如播放状态变化）需要通知多个组件的场景

#### 数据流设计

插件的数据流遵循单向流动原则，保证状态管理的清晰性：

1. **用户交互** → **UI组件** → **发送消息** → **Background处理** → **存储更新** → **广播状态变化** → **UI更新**

2. **数据持久化**：所有需要持久化的数据统一由Background Script管理写入IndexedDB，确保数据一致性

### 4.1 音频提取与存储

1. **音频爬虫实现**
  # 在 python 中可行的爬虫方案（需要你自己转换为js代码）
  ```python
  import json
  from bs4 import BeautifulSoup
  import requests
  from config.config import CREEPER_BILI_HEADERS
  import re
  #import utils.log_utils as log

  # 参数url即当前窗口的url
  def get_bili_video_info(url):
      headers = CREEPER_BILI_HEADERS
      # 发送请求
      response = requests.get(url=url, headers=headers)
      if response.status_code == 200:
          # 获取html
          html_content = response.text
      else:
          print(response.status_code)
          print(response.content)
          return None

      match = re.findall('<script>window.__playinfo__=(.*?)</script>', html_content)
      if match:
          json_string = match[0]
          json_data = json.loads(json_string)
          video_info = json_data['data']['dash']
          video_url = video_info['video'][0]['baseUrl']
          audio_url = video_info['audio'][0]['baseUrl'] # 这里的 audio_url 即为b站视频对应音频的链接
      else:
          return None

      # 获取视频信息
      soup = BeautifulSoup(html_content, 'html.parser')
      meta_list = soup.select('meta[itemprop]')
      meta_info = [{"name": meta.get('itemprop'), "content": meta.get('content')} for meta in meta_list]
      """
      meta_info 示例数据：
      ```JSON
      [{'content': '在百万豪装录音棚大声听 '
                    '廖俊涛《谁》【Hi-res】,发现《谁》,音乐分享官,高音质,音响,谁,录音棚,Hi-Fi,廖俊涛,Hi-res,音乐玩家招募令第三期,音乐,哔哩哔哩,bilibili,B站,弹幕',
          'name': 'keywords'},
        {'content': '《谁》是廖俊涛演唱的歌曲，由廖俊涛作词、作曲、编曲，2017年6月14日发行。录音设备：话筒：Neumann M149 tube '
                    'Pair调音台：SSL Duality Delta Pro Station工作站：PT音箱：Barefoot MM12[侵删], '
                    '视频播放量 4791362、弹幕量 1561、点赞数 74805、投硬币枚数 22026、收藏人数 96594、转发人数 '
                    '9584, 视频作者 JLRS-LeoFM, 作者简介 '
                    '欢迎Hi-Fi&汽车&专业音响试听、国乐、合唱团、音乐改编、原创音乐、同期录音、全景声混录等声音相关的一切合作！，相关视频：热门歌曲！洋澜一这首《谁》后劲太大了！深情的歌声，入耳入心，洋澜一《谁》无损音质完整版饭制MV，又出神曲了，霸占音乐榜首，【Hi-Res无损】盛哲《在你的身边》「我想在你的身边 '
                    '忘了这路有多长」动态歌词，陈奕迅《孤独患者》百万豪装录音棚大声听【Hi-res】，《唯一》告五人～我真的爱你 '
                    '句句不轻易，在百万豪装录音棚大声听 '
                    '邓紫棋《唯一》【Hi-res】，在百万豪装录音棚大声听米津玄师《Lemon》【Hi-res】，在百万豪装录音棚大声听 '
                    '薛之谦《天外来物》【Hi-res】，郭采洁《你在,不在》百万豪装录音棚大声听【Hi-res】，在百万豪装录音棚大声听五月天《后来的我们》【Hi-res】',
          'name': 'description'},
        {'content': 'JLRS-LeoFM', 'name': 'author'},
        {'content': '在百万豪装录音棚大声听 廖俊涛《谁》【Hi-res】_哔哩哔哩_bilibili', 'name': 'name'},
        {'content': 'https://www.bilibili.com/video/BV1VN4y1C7sv/', 'name': 'url'},
        {'content': '//i1.hdslb.com/bfs/archive/afde827fe873857f352e9a3de84c2186ece1941b.jpg@100w_100h_1c.png',
          'name': 'image'},
        {'content': '//i1.hdslb.com/bfs/archive/afde827fe873857f352e9a3de84c2186ece1941b.jpg@100w_100h_1c.png',
          'name': 'thumbnailUrl'},
        {'content': '2023-10-19 11:29:49', 'name': 'uploadDate'},
        {'content': '2023-10-19 11:29:49', 'name': 'datePublished'}
      ]
      ```
      """
  ```

2. **数据存储方案**
   - 使用浏览器内置 IndexedDB 存储歌单和音频数据
   - 音频元数据（标题、UP主、封面图URL等）存储在本地
   - 考虑音频文件体积，仅存储音频链接，不缓存音频文件
   - 定期检查链接有效性，处理失效链接

   1. **存储空间管理**：
      - 使用 IndexedDB 存储主要数据，适用于较大数据量
      - 实现数据分片存储，避免超出单次写入限制
      - 设计 LRU（最近最少使用）缓存策略，当存储接近限制时自动清理长期未使用的音频数据

   2. **数据一致性保障**：
      - 所有数据写入操作通过统一的事务处理，避免并发写入冲突
      - 实现事务性操作，确保关联数据的更新具有原子性
      - 数据变更后广播通知所有活跃组件更新视图

   3. **链接有效性维护**：
      - 定期（如每周）检查存储的音频 URL 是否有效
      - 对于失效链接，标记状态并在用户访问时尝试重新获取
      - 记录视频原始信息，便于失效时重新爬取
      - 实现智能重试机制，根据失败原因采取不同恢复策略

### 4.2 页面交互

1. **B站页面增强**
   - 通过 content script 在视频页面注入自定义收藏按钮，到时候我会给出注入的位置
   - 使用 MutationObserver 监听页面变化，确保在视频切换时按钮依然存在
   - 使用消息传递与 background script 通信

   #### 页面增强详细实现
   
   1. **页面类型检测**：
      - Content Script 启动时检测当前页面是否为B站视频页面
      - 监听URL变化，支持SPA页面跳转检测
      - 检测页面类型的正则表达式：
        ```javascript
        const isBilibiliVideoPage = () => {
          return /^https?:\/\/(www\.|m\.)?bilibili\.com\/video\//.test(window.location.href);
        };
        ```
      - 只有在视频页面才激活收藏功能

   2. **注入时机控制**：
      - 在`document.readyState === "complete"`时进行初始注入
      - 使用`window.location.href`变化检测处理页面无刷新跳转
      - 针对B站SPA特性，监听`pushState`和`replaceState`事件

   3. **DOM元素注入策略**：
      - 分析B站视频页面DOM结构，识别适合注入按钮的锚点元素（控制栏）
      - 在控制栏的适当位置（如点赞按钮旁）注入自定义收藏按钮
      - 按钮设计与B站原生按钮保持一致，但使用音符图标区分

   4. **按钮状态管理**：
      - 通过查询Background中的存储数据，显示视频是否已收藏的状态
      - 实现按钮的多状态显示（未收藏/已收藏/收藏中）
      - 针对已收藏视频，悬停时显示"已收藏到xxx歌单"提示

2. **Popper 层实现**
   - 动态创建DOM元素，样式与B站设计风格一致
   - 显示收藏选项：默认收藏到"未归类"或选择指定歌单
   - 提供快速创建新歌单和进入主播放器页面的入口
   - 一键收藏功能的视觉反馈

   #### Popper层详细设计
   
   1. **功能定位**：
      - Popper层的核心功能是提供视频音频的快速收藏
      - 包含两个主要功能：收藏到歌单和进入播放器主页
      - 设计简洁直观，减少操作步骤

   2. **弹出层定位算法**：
      - 根据收藏按钮位置动态计算弹出层显示位置
      - 实现智能边界检测，确保不超出视口范围
      - 支持自适应屏幕大小，在小屏幕上调整弹出层大小

   3. **歌单选择区域**：
      - 顶部显示"收藏到歌单"标题
      - 默认选中"未归类"歌单
      - 显示最近使用的3-5个歌单
      - 提供"更多歌单"选项展开完整列表
      - 选择歌单后立即高亮反馈

   4. **快捷操作区域**：
      - "一键收藏"按钮：收藏到当前选中歌单
      - "新建歌单"按钮：快速创建新歌单
      - "前往播放器"按钮：打开播放器主页面
      - 收藏成功状态的视觉反馈

   5. **收藏状态处理**：
      - 未收藏状态：显示正常收藏选项
      - 收藏中状态：显示加载动画
      - 已收藏状态：显示"已收藏到xxx歌单"，提供"更改歌单"选项
      - 收藏失败状态：显示错误提示和重试按钮
   
   6. **创建歌单快捷表单**：
      - 简化的歌单创建表单，包含名称输入
      - 可选的封面上传
      - 创建成功后自动选择新建歌单
      - 表单验证确保歌单名称有效

### 4.3 播放器主页面实现

1. **播放器页面设计**
   - 独立的播放器主页面，可通过插件图标或Popper层进入
   - 包含完整的歌单管理、歌曲列表和播放控制功能
   - 支持所有高级播放功能和个性化设置

   #### 播放器页面详细功能
   
   1. **主要功能区域**：
      - 左侧：歌单导航区，管理所有歌单
      - 中间：歌曲列表区，显示当前歌单中的歌曲
      - 底部：播放控制栏，控制音频播放

   2. **歌单管理功能**：
      - 创建、编辑、删除和排序歌单
      - 歌单封面和描述编辑
      - 歌曲在歌单间移动和复制
      - 歌单搜索和筛选

   3. **歌曲管理功能**：
      - 歌曲元数据编辑（标题、UP主、标签等）
      - 歌曲排序和筛选
      - 批量操作（删除、移动）
      - 歌曲搜索

   4. **播放控制功能**：
      - 基本控制：播放/暂停、上一首/下一首、音量调节
      - 高级控制：播放模式切换、播放速度调整
      - 播放队列管理
      - 播放历史记录

3. **UI交互逻辑**
   - 使用事件委托处理用户交互
   - 实现自定义的拖放接口
   - 使用状态管理模式管理播放器状态
   - 提供丰富的快捷键支持
   
   #### UI交互详细实现
   
   1. **状态管理系统**：
      - 实现集中式状态管理：
        ```javascript
        class PlayerState {
          constructor() {
            this._state = {
              currentSong: null,
              isPlaying: false,
              volume: 0.8,
              currentPlaylist: null,
              // 其他状态...
            };
            this.listeners = [];
          }
          
          getState() {
            return { ...this._state };
          }
          
          setState(partialState) {
            this._state = { ...this._state, ...partialState };
            this.notifyListeners();
          }
          
          subscribe(listener) {
            this.listeners.push(listener);
            return () => {
              // 返回取消订阅函数
              this.listeners = this.listeners.filter(l => l !== listener);
            };
          }
          
          notifyListeners() {
            this.listeners.forEach(listener => listener(this._state));
          }
        }
        ```
      - 各UI组件订阅状态变化，实现响应式更新
      - 状态变更通过Background Script同步到所有页面
   
   2. **快捷键系统**：
      - 使用键盘事件映射表实现快捷键绑定
      - 支持自定义快捷键配置
      - 实现上下文敏感的快捷键（如在搜索框中禁用某些全局快捷键）
   
   3. **进度条交互**：
      - 实现精确的拖动定位功能
      - 支持点击跳转到特定位置
      - 显示缓冲进度和已播放进度
      - 实现预览功能，鼠标悬停时显示时间点
   
   4. **动画与过渡效果**：
      - 使用CSS transitions和animations实现平滑过渡
      - 关键操作添加适当动效提供视觉反馈
      - 优化动画性能，使用transform和opacity属性
      - 支持禁用动画的选项，兼顾性能与可访问性

### 4.4 扩展功能实现

1. **数据导入导出**
   - 实现JSON格式的数据导出功能
   - 验证导入数据的完整性和有效性
   - 处理导入时可能的数据冲突
   
   #### 数据导入导出详细实现
   
   1. **数据序列化方案**：
      - 设计可扩展的JSON数据格式：
        ```javascript
        {
          "format_version": "1.0",
          "export_time": "ISO时间字符串",
          "data": {
            "playlists": [...],
            "songs": {...}
          },
          "config": {
            // 导出的配置项
          }
        }
        ```
      - 实现分级导出策略，支持只导出选定歌单
      - 添加元数据信息，如导出时间、版本等
   
   2. **导出处理流程**：
      - 从存储中读取相关数据
      - 按照定义的格式组织数据
      - 生成JSON文件并使用`createObjectURL`创建下载链接
      - 支持大数据分片导出，避免内存问题
   
   3. **导入验证机制**：
      - 实现格式和版本检查
      - 验证数据完整性（必要字段、引用完整性等）
      - 使用JSON Schema进行数据结构验证
      - 提供导入预览，显示将要导入的内容概要
   
   4. **冲突处理策略**：
      - 检测并标识重复数据
      - 提供冲突解决选项：保留原有、使用导入、两者保留
      - 实现智能合并功能，合并不冲突部分
      - 支持导入后的回滚机制，在出错时恢复原状态

2. **主题和样式定制**
   - 使用CSS变量实现主题切换
   - 提供预设主题和自定义选项
   - 使用本地存储保存用户偏好设置
   
   #### 主题系统详细实现
   
   1. **CSS变量设计**：
      - 设计全面的主题变量体系：
        ```css
        :root {
          /* 主要颜色 */
          --primary-color: #8A2BE2;
          --secondary-color: #1E90FF;
          --accent-color: #FF5CAD;
          
          /* 背景和边框 */
          --background-primary: #ffffff;
          --background-secondary: #f5f5f5;
          --border-color: #e0e0e0;
          
          /* 文本颜色 */
          --text-primary: #333333;
          --text-secondary: #777777;
          
          /* 组件相关 */
          --button-radius: 4px;
          --panel-radius: 8px;
          
          /* 动画时间 */
          --transition-fast: 0.15s;
          --transition-normal: 0.25s;
          --transition-slow: 0.4s;
          
          /* 其他主题变量... */
        }
        
        /* 深色主题 */
        [data-theme="dark"] {
          --primary-color: #9D4EDD;
          --background-primary: #121212;
          --text-primary: #f0f0f0;
          /* 其他变量覆盖... */
        }
        ```
      - 确保所有样式都使用CSS变量，便于主题切换
   
   2. **主题切换机制**：
      - 实现主题切换功能，动态修改`data-theme`属性
      - 添加平滑过渡效果，避免突兀的样式变化
      - 支持跟随系统设置（使用`prefers-color-scheme`媒体查询）
      - 提供主题预览功能
   
   3. **自定义主题编辑器**：
      - 实现可视化主题编辑器
      - 支持颜色选择器和实时预览
      - 允许导入/导出自定义主题
      - 保存用户自定义主题到存储中
   
   4. **响应式主题适配**：
      - 根据屏幕尺寸动态调整主题参数
      - 针对移动设备优化交互元素大小
      - 确保所有主题在不同设备上都有良好表现

3. **扩展插件架构**

   #### 扩展性设计
   
   1. **插件化架构**：
      - 设计插件接口和生命周期事件：
        ```javascript
        class PluginSystem {
          constructor() {
            this.plugins = new Map();
            this.hooks = {
              onInitialize: [],
              onPlayStart: [],
              onPlayPause: [],
              onSongChange: [],
              // 其他钩子点...
            };
          }
          
          registerPlugin(plugin) {
            if (this.validatePlugin(plugin)) {
              this.plugins.set(plugin.id, plugin);
              this.attachHooks(plugin);
              if (plugin.initialize) plugin.initialize(this.getAPI());
            }
          }
          
          triggerHook(hookName, ...args) {
            if (this.hooks[hookName]) {
              this.hooks[hookName].forEach(fn => {
                try {
                  fn(...args);
                } catch (err) {
                  console.error(`Plugin error in ${hookName}:`, err);
                }
              });
            }
          }
          
          // 其他方法...
        }
        ```
      - 提供安全的API层，限制插件的权限范围
      - 实现插件的启用/禁用/卸载功能
   
   2. **权限管理**：
      - 定义不同级别的插件权限
      - 用户可控制每个插件的权限授权
      - 实现沙箱机制，限制插件对核心功能的访问
   
   3. **错误隔离**：
      - 使用`try-catch`和Promise错误处理隔离插件错误
      - 监控插件性能，检测并处理异常资源占用
      - 提供错误报告机制，便于调试和修复
   
   4. **示例插件**：
      - 开发几个示例插件作为参考：
        - 音频可视化效果插件
        - 睡眠定时器插件
        - 歌词显示插件
        - 数据统计插件
      - 提供插件开发文档和API参考

4. **安全性与性能优化**

   #### 安全与性能实现
   
   1. **内容安全策略**：
      - 实现严格的CSP (Content Security Policy)
      - 防止XSS攻击和恶意代码注入
      - 使用安全的资源加载策略
   
   2. **资源管理优化**：
      - 实现资源懒加载，按需加载组件和资源
      - 使用Web Workers处理密集型计算任务
      - 实现内存使用监控和优化策略
   
   3. **缓存策略**：
      - 实现多级缓存系统：
        - 内存缓存：频繁访问的小型数据
        - IndexedDB：大型数据和媒体信息
        - Service Worker：核心资源和离线功能
      - 设计缓存过期和刷新策略
   
   4. **性能监控**：
      - 实现关键性能指标监控（加载时间、交互延迟等）
      - 开发调试模式下提供性能分析工具
      - 根据用户设备性能动态调整功能复杂度

### 4.5 插件部署与更新

1. **打包与分发**
   - 使用Webpack或Rollup进行代码打包和优化
   - 实现源代码混淆和压缩，减小插件体积
   - 针对Chrome/Firefox/Edge等浏览器分别打包
   - 自动化构建流程，使用CI/CD系统

2. **更新机制**
   - 实现版本检查功能，定期检查新版本
   - 提供静默更新和手动更新选项
   - 实现增量更新，减少下载和安装时间
   - 更新后展示新功能介绍，提升用户体验

3. **兼容性处理**
   - 实现浏览器特性检测，针对不同浏览器使用不同实现
   - 保持向后兼容性，支持旧版本数据格式
   - 提供降级功能，在低性能设备上禁用高级特性
   - 使用polyfill确保跨浏览器一致性

## 5. UI样式描述

### 5.1 整体设计风格

采用现代简约风格，以流畅的动画和清晰的层次结构为设计重点。整体风格参考 Spotify 和网易云音乐的简洁与优雅，同时融入 B站 的活泼元素。

**配色方案：**
- 主色调：深紫色 (#8A2BE2) - 代表创意和独特性
- 辅助色：天蓝色 (#1E90FF) - 提供对比和活力
- 强调色：粉红色 (#FF5CAD) - 呼应B站的粉色调
- 中性色：
  - 深灰 (#333333) - 用于文本和重要元素
  - 中灰 (#777777) - 用于次要文本
  - 浅灰 (#EEEEEE) - 用于背景和分隔

**排版：**
- 主标题：16-18px，加粗，主色调
- 副标题：14-16px，半粗体，深灰色
- 正文：14px，常规字重，深灰色
- 次要文本：12-13px，常规字重，中灰色

**整体布局：**
- 采用网格布局（Grid Layout）和弹性布局（Flex）结合
- 响应式设计，适应不同尺寸的弹出窗口
- 合理的留白和间距，增强可读性和操作便捷性

### 5.1 整体设计风格

设计理念基于"柔和优雅"的核心价值观，创造一个平衡视觉美感与功能性的界面。整体风格追求轻盈通透的质感，温润柔和的色彩，以及流畅自然的交互体验。

#### 柔和优雅的配色方案

**主色调系列：**
- 主色：淡紫藤色 (#A293E1) - 高贵而不张扬，温柔而有特性
- 主色深：深紫藤色 (#7A67C7) - 用于强调和交互元素
- 主色浅：薰衣草色 (#C9C1F0) - 用于背景和次要元素

**辅助色系列：**
- 辅助色：青玉色 (#A8D8D5) - 提供平衡和清新感
- 辅助色深：湖蓝色 (#5EAAA8) - 用于次要按钮和图标
- 辅助色浅：薄荷色 (#D1EAE9) - 用于轻微背景强调

**强调色系列：**
- 强调色：珊瑚粉 (#F7BFB4) - 呼应B站的粉色调，但更加柔和
- 强调色深：玫瑰粉 (#E7968A) - 用于特殊强调和提醒
- 强调色浅：贝壳粉 (#FCDAD0) - 用于微妙点缀和状态指示

**中性色系列：**
- 纯白：(#FFFFFF) - 主要背景色
- 象牙白：(#F9F7F7) - 次要背景色
- 薄雾灰：(#E8E8EE) - 分割线和边框
- 青石灰：(#ACADB9) - 次要文本
- 墨青灰：(#4A4B57) - 主要文本和图标
- 夜空蓝：(#232336) - 深色模式背景和强调

#### 精致细腻的排版系统

**字体选择：**
- 主要字体：系统默认无衬线字体（San Francisco / Segoe UI / Roboto）
- 强调字体：适度圆润的无衬线字体，增添亲和力
- 数字字体：等宽字体，提升信息层次感

**文字大小与行高：**
- 大标题：20-22px，行高1.4，轻薄字重（300）
- 主标题：18px，行高1.4，常规字重（400）
- 副标题：16px，行高1.5，常规字重（400）
- 正文：14px，行高1.6，常规字重（400）
- 辅助文本：13px，行高1.5，常规字重（400）
- 次要文本：12px，行高1.5，常规字重（400）

**文字渲染：**
- 采用平滑的字体渲染
- 适当的字间距（0.2px）增强可读性
- 标题使用轻微字间距（0.5px）提升优雅度

#### 形状与边框

**圆角处理：**
- 大组件（卡片、面板）：12px圆角，营造柔和感
- 中等组件（按钮、输入框）：8px圆角
- 小组件（标签、徽章）：4px圆角

**边框风格：**
- 轻薄边框（1px），色值为薄雾灰(#E8E8EE)
- 重要元素使用阴影代替边框，创造漂浮感
- 分割线使用低对比度的浅色线条，降低视觉干扰

#### 阴影系统

**层次化阴影：**
- 一级阴影：`0 2px 5px rgba(0,0,0,0.05)`，用于轻微提升
- 二级阴影：`0 4px 10px rgba(0,0,0,0.08)`，用于卡片和面板
- 三级阴影：`0 8px 20px rgba(0,0,0,0.12)`，用于弹窗和浮层
- 焦点阴影：`0 0 0 3px rgba(162,147,225,0.3)`，用于交互元素的焦点状态

**呼吸动效：**
- 悬停状态下阴影轻微扩大，增强交互感
- 转场过程中阴影深度变化，提供空间感

#### 空间与节奏

**留白策略：**
- 外边距一致性：使用8px的倍数（8px, 16px, 24px, 32px）
- 内边距层次：小(12px)、中(16px)、大(24px)
- 内容区块间距：20px-32px，创造舒适阅读节奏

**网格系统：**
- 基于8px为基本单位的网格系统
- 主要内容区域使用12列网格布局
- 卡片和面板内部使用弹性布局，增强适应性

#### 交互与动效

**交互反馈：**
- 按钮点击：轻微缩小(scale 0.98)并加深颜色
- 悬停状态：微妙的明度变化(亮度+5%)和阴影增强
- 聚焦状态：主色调光环效果，增强可访问性

**动画时间：**
- 快速过渡：150ms，用于即时反馈（如按钮状态）
- 标准过渡：250ms，用于组件变化（如卡片展开）
- 舒缓过渡：400ms，用于页面转场和主要动效

**动画曲线：**
- 标准曲线：ease-out (cubic-bezier(0.33, 1, 0.68, 1))
- 弹性曲线：cubic-bezier(0.34, 1.56, 0.64, 1)，用于愉悦感
- 舒缓曲线：cubic-bezier(0.65, 0, 0.35, 1)，用于自然感

#### 图标与插图风格

**图标设计：**
- 线性图标，2px线宽，圆角处理
- 大小统一：16px(小)、20px(中)、24px(大)
- 图标颜色跟随文本颜色，保持一致性
- 强调状态使用主色调填充效果

**插图风格：**
- 简约插画风格，线条流畅，色彩柔和
- 使用主色调和辅助色作为主要配色
- 适度的细节和装饰，不过分复杂
- 统一的透视和比例，保持视觉一致性

### 5.2 Popper层设计

#### 整体容器设计

**形态与质感：**
- 容器形状：圆角矩形，圆角半径12px，营造柔和感
- 尺寸比例：宽度280px，高度根据内容自适应，最大高度不超过屏幕高度的70%
- 背景效果：主背景为纯白(#FFFFFF)，叠加2%不透明度的主色调滤镜
- 边框处理：不使用明显边框，用阴影替代
- 阴影效果：`0 8px 20px rgba(0,0,0,0.12), 0 2px 5px rgba(0,0,0,0.08)`，创造悬浮感

**指示箭头：**
- 箭头形状：等边三角形，顶角圆滑化处理
- 尺寸大小：8px × 8px，与容器协调
- 定位方式：根据触发按钮位置智能定位，默认居中对齐
- 颜色处理：与容器背景色一致，并添加微妙的渐变效果
- 阴影连贯：箭头阴影与容器阴影保持一致，形成整体感

**动画效果：**
- 进入动画：淡入(opacity)与微缩放(scale)结合，从0.95缩放到1.0
- 退出动画：淡出与微缩放结合，动画时长略短于进入动画(200ms)
- 动画曲线：进入使用舒缓曲线cubic-bezier(0.2, 0.9, 0.3, 1)，退出使用ease-out
- 转场效果：不同位置出现时，添加微妙的位移过渡

#### 内部结构与布局

**标题区域：**
- 视觉处理：标题文字"收藏到歌单"，18px，轻薄字重(300)，墨青灰色(#4A4B57)
- 空间分配：上下内边距16px，左右内边距20px
- 分隔方式：底部使用1px薄雾灰(#E8E8EE)分隔线，线条两端留有8px间距
- 特殊效果：标题文字微妙的字间距(0.5px)增强优雅感

**歌单列表区域：**
- 布局结构：垂直列表，每项高度为60px
- 内部间距：顶部和底部各有12px内边距
- 滚动处理：超出5个项目时显示自定义滚动条
- 滚动条样式：宽度4px，圆角，半透明主色浅色(#C9C1F0)，悬停时加深

**歌单单项设计：**
- 项目高度：60px，内部上下居中对齐
- 水平布局：左侧封面(40px²)，中间名称，右侧选择状态
- 内边距：左右20px，创造呼吸感
- 封面样式：圆形，阴影`0 2px 4px rgba(0,0,0,0.1)`
- 空封面处理：使用渐变色圆形，基于歌单名称生成唯一颜色
- 歌单名称：14px，正常字重，最多显示一行，超出部分省略
- 歌曲数量：12px，青石灰(#ACADB9)，紧随歌单名称显示
- 选中状态：左侧显示2px宽、24px高的主色竖条
- 选中效果：背景色变为薰衣草色(#C9C1F0)的10%透明度版本
- 悬停效果：背景色变为主色的5%透明度版本，平滑过渡(150ms)

**操作区域：**
- 位置安排：底部固定区域，与内容区有明确分隔
- 分隔方式：顶部1px薄雾灰分隔线，线条两端留有8px间距
- 空间分配：上下内边距16px，左右内边距20px
- 按钮排列：水平排列，两端对齐

**按钮样式：**
- 主按钮："一键收藏"按钮
  - 尺寸：高度36px，宽度根据内容自适应，最小80px
  - 背景：主色深(#7A67C7)，悬停时略微变亮
  - 文字：白色，14px，字重500
  - 圆角：8px，营造柔和感
  - 阴影：轻微阴影`0 2px 5px rgba(122,103,199,0.3)`
  - 点击效果：轻微缩小(scale 0.98)并加深背景色

- 次要按钮："创建新歌单"和"前往播放器"按钮
  - 尺寸：高度36px，内容自适应
  - 样式：文字按钮，无背景，无边框
  - 颜色：主色深(#7A67C7)，悬停时颜色加深
  - 图标：左侧添加相应图标，与文字间距8px
  - 悬停效果：文字下方出现1px主色下划线，平滑过渡

#### 特殊状态设计

**收藏中状态：**
- 主按钮转换为加载状态
- 显示细小的圆形加载动画，白色，居中
- 文字变为"收藏中..."，不可点击
- 其他按钮暂时禁用，显示为淡灰色

**已收藏状态：**
- 顶部状态指示：绿色成功提示"已收藏到xxx歌单"
- 主按钮替换为"更改歌单"
- 增加"在歌单中查看"链接按钮
- 添加微妙的成功动画：短暂的绿色波纹效果

**收藏失败状态：**
- 顶部显示错误提示，使用浅红色背景(#FFEBEE)和红色文字(#D32F2F)
- 错误图标与文字组合
- 主按钮变为"重试"
- 添加"详细信息"折叠区，可展开查看失败原因

**新建歌单表单：**
- 触发方式：点击"创建新歌单"按钮
- 过渡效果：从底部滑入，高度自适应
- 占位方式：替换原有内容，而非弹出新窗口
- 表单元素：
  - 歌单名称输入框：居中，宽度100%
  - 可选的封面上传/选择：小型预览+上传按钮
  - "取消"和"创建"按钮：底部右对齐
- 错误提示：内联显示，输入框下方

#### Popper层与主页面的联系

**跳转控制：**
- "前往播放器"按钮位置：底部左侧，与创建歌单并排
- 视觉表现：图标+文字组合，使用次要按钮样式
- 点击效果：平滑淡出当前Popper，并打开播放器主页
- 转场衔接：打开播放器页面时，自动定位到相关歌单（如果有）

**状态同步：**
- 在播放器主页面修改的歌单信息实时反映在Popper层
- 刚收藏的歌曲在播放器中自动标记为"新添加"
- 收藏操作会更新播放器页面的"最近添加"分类

### 5.3 主播放器页面设计

**整体布局：**
- 三栏式设计：
  - 左侧：歌单导航区（宽度约25%）
  - 中间：歌曲列表区（宽度约75%）
  - 底部：固定高度的播放器控制栏（高度约80px）

**歌单导航区：**
- 顶部：插件logo和名称
- 中部：系统歌单（未归类、最近播放、收藏）
- 下部：用户创建的歌单列表
- 底部：创建新歌单按钮

**歌曲列表区：**
- 顶部：当前歌单信息展示区
  - 左侧：歌单封面（大图）
  - 右侧：歌单名称、描述、歌曲数量等信息
- 中部：功能按钮栏（播放全部、排序方式、搜索）
- 下部：歌曲列表，包含：
  - 歌曲封面（小图）
  - 歌曲标题
  - UP主名称
  - 时长
  - 操作按钮（喜欢、添加到其他歌单、删除）

**播放器控制栏：**
- 左侧：当前播放歌曲信息
  - 歌曲封面（小图）
  - 歌曲标题和UP主名称
  - 喜欢按钮
- 中部：播放控制区
  - 上一首、播放/暂停、下一首按钮
  - 进度条（可拖动）
  - 当前时间/总时间显示
- 右侧：辅助控制区
  - 音量控制
  - 播放模式切换
  - 播放队列按钮

**组件样式细节：**

1. **歌单项：**
   - 圆角矩形容器
   - 左侧小型封面图（40x40px）
   - 右侧歌单名称和歌曲数量
   - 悬停时背景色变为浅色主题色
   - 当前选中的歌单背景色加深，左侧有彩色指示条

2. **歌曲项：**
   - 高度约60px的条目
   - 封面图为圆角方形（50x50px）
   - 标题使用较大字号，UP主名称使用较小字号和次要颜色
   - 鼠标悬停时显示操作按钮，替换时长显示
   - 当前播放的歌曲有特殊标记和高亮效果

3. **播放控制按钮：**
   - 圆形按钮，内含图标
   - 主播放/暂停按钮较大（40px），其他控制按钮较小（32px）
   - 按钮点击时有缩放反馈效果
   - 图标使用线性风格，保持整体一致性

4. **进度条：**
   - 高度为4px的细长条
   - 已播放部分使用主色调
   - 未播放部分使用浅灰色
   - 拖动手柄为圆形，直径12px
   - 鼠标悬停时进度条高度增加到6px，增强可操作性

5. **音量控制：**
   - 图标+滑动条组合
   - 滑动条垂直方向展开
   - 静音时图标变化，提供视觉反馈

**动画效果：**
- 页面切换使用渐变过渡
- 歌单切换时内容区有滑动效果
- 播放状态变化时按钮有平滑的图标变换
- 音量调节时有实时反馈效果
- 列表滚动时使用惯性滚动

**响应式调整：**
- 窗口变窄时自动隐藏左侧歌单导航，可通过菜单按钮调出
- 窄屏模式下简化播放器控制栏，只保留核心控件
- 支持最小化播放器模式，只显示简化的控制栏

### 5.3 主播放器页面设计

#### 整体布局构成

**页面架构：**
- 布局方式：三区域分离式设计，创造层次感与功能区隔
- 尺寸比例：
  - 左侧导航：固定宽度240px（在宽屏下）或25%（在窄屏下）
  - 主内容区：自适应剩余宽度或75%
  - 底部播放控制：固定高度76px
- 背景处理：
  - 主背景为纯白(#FFFFFF)，确保内容清晰可读
  - 侧边导航背景略微加深，使用象牙白(#F9F7F7)
  - 播放控制区使用微妙渐变背景，从左到右主色透明度从3%到1%
- 阴影分割：
  - 侧边导航与主内容间使用淡化阴影分隔
  - 播放控制区顶部使用微妙上投阴影，营造浮动感

**视觉平衡与留白：**
- 主体内边距：四周均匀20px内边距，营造呼吸感
- 内容间距：遵循8px倍数规则设计间距，创造节奏感
- 区块分隔：关键功能区块间使用24px-32px间距
- 对齐基准：所有内容左对齐，保持统一的视觉起点

**交互区过渡：**
- 侧边导航与主内容区切换时的平滑过渡动画(300ms)
- 内容更新时微妙的淡入淡出效果(200ms)
- 播放控制区与主内容区分离但视觉统一，同色系呼应

#### 左侧歌单导航区设计

**顶部标识区：**
- 高度：88px，上下留白充足
- LOGO设计：抽象的音符与B站标识结合，使用主色深色(#7A67C7)
- 名称：20px字号，轻薄字重(300)，宽字符间距
- 定位方式：居左对齐，距离左边缘20px
- 底部分隔：使用1px薄雾灰分隔线，左右有16px留白

**系统歌单：**
- 分组标签：12px字号，字重500，青石灰色，全大写，左对齐
- 项目间距：单个歌单项高度60px，项目间无分隔
- 图标处理：使用扁平化线性图标，16px大小，与文字间距12px
- 特殊处理：
  - "未归类"使用随机色块拼接图标
  - "最近播放"使用时钟图标
  - "收藏"使用心形图标

**用户歌单：**
- 分组标签：同系统歌单，但增加"我的歌单"副标题
- 歌单计数：在分组标签旁显示总计数(如"12个歌单")
- 滚动处理：独立滚动区域，使用自定义滚动条
- 歌单项高度：56px，比系统歌单略紧凑

**单个歌单项设计：**
- 结构布局：左侧封面(40px²)，右侧名称和计数
- 封面处理：正方形圆角(8px)，内容溢出隐藏
- 无封面时：使用基于歌单名生成的渐变色块
- 文字样式：
  - 歌单名：14px，正常字重，单行显示，溢出省略
  - 歌曲数：12px，青石灰色，以"首"为单位
- 选中状态：左侧3px宽主色指示条，背景为薰衣草色(#C9C1F0)的15%透明度
- 悬停效果：背景为主色的7%透明度，过渡时间150ms
- 右侧功能：悬停时显示"•••"更多按钮，点击显示菜单

**底部创建区：**
- 固定位置：粘连在导航底部
- 高度：64px，上下居中
- 上部分隔：1px薄雾灰分隔线
- 按钮样式：
  - 文字+图标组合，图标为"+"
  - 14px字号，主色深色文字
  - 悬停效果：文字下出现短横线，由中间向两侧扩展

**折叠状态设计：**
- 触发方式：窗口宽度<768px或用户手动折叠
- 折叠宽度：60px，仅显示图标
- 图标居中：所有图标垂直排列居中
- 提示处理：悬停时显示浮动提示，显示完整歌单名
- 展开按钮：位于底部，使用双箭头图标

#### 主内容区 - 歌曲列表设计

**歌单信息头部：**
- 高度：自适应，最小160px
- 布局：左侧大封面，右侧信息区
- 间距：元素间24px间距，创造呼吸感
- 背景效果：可选的封面色彩模糊背景，透明度10%

**封面设计：**
- 尺寸：120px × 120px
- 形状：圆角矩形，12px圆角
- 阴影：轻微阴影`0 4px 12px rgba(0,0,0,0.1)`
- 无封面效果：基于歌单名生成的渐变色块
- 播放状态：封面上悬停显示半透明播放按钮

**歌单信息：**
- 歌单名称：20px字号，字重500，1.4行高
- 创建信息：13px字号，青石灰色，创建时间和更新时间
- 歌曲计数：14px字号，墨青灰色，显示总时长
- 描述文本：14px字号，行高1.6，最多显示3行，有"展开"选项
- 操作按钮：水平排列，"播放全部"、"编辑"、"删除"等

**功能栏：**
- 高度：56px
- 背景：比内容区略深，象牙白色(#F9F7F7)
- 左侧：播放模式选择和排序方式下拉菜单
- 右侧：搜索框，自动聚焦时展开

**歌曲列表：**
- 表头设计：
  - 高度：40px
  - 背景：透明
  - 字体：13px，字重500，青石灰色
  - 分栏：序号、歌曲、作者、时长和操作
- 分隔线：表头下方1px薄雾灰分隔线
- 空白状态：居中显示"暂无歌曲"插图和文字

**单曲项设计：**
- 高度：64px（标准）或72px（宽松模式）
- 圆角：上下两端歌曲项使用4px圆角
- 悬停效果：背景色变为主色5%透明度，平滑过渡
- 播放中效果：左侧序号替换为动态音波图标，文字变为主色
- 结构分布：
  - 序号列：固定40px宽，文字居中
  - 歌曲列：左侧封面（56×56px方形圆角8px）+右侧文字
  - 文字叠层：标题14px字重500，UP主12px青石灰色
  - 时长列：固定80px宽，居中显示
  - 操作列：固定100px宽，悬停时显示图标按钮组

**分页控制：**
- 位置：列表底部，居中
- 样式：简约数字分页，当前页高亮
- 快速跳转：首页、末页快捷按钮
- 页数显示：显示"第X页/共Y页"

#### 底部播放控制栏设计

**整体效果：**
- 高度：76px
- 背景：纯白微妙渐变，主色调渗入2%
- 阴影：顶部投影`0 -2px 10px rgba(0,0,0,0.05)`
- 边框：顶部1px薄雾灰分隔线
- 层次：始终保持在最上层，滚动时固定

**左侧：当前歌曲信息**
- 宽度：25%，最小240px，最大320px
- 封面：56×56px，圆角8px
- 歌曲信息：
  - 标题：14px字重500，单行溢出省略
  - UP主：12px青石灰色
- 喜欢按钮：心形图标，未选中灰色，选中为强调色(#F7BFB4)
- 菜单按钮：三点图标，点击展开更多选项

**中部：播放控制**
- 控制按钮组：
  - 布局：水平居中排列，按钮间距16px
  - 上一首/下一首：圆形按钮，直径36px，线性图标
  - 播放/暂停：圆形按钮，直径48px，主色深背景，白色图标
  - 悬停效果：微妙放大(scale 1.05)和阴影增强
  
- 进度控制：
  - 位置：按钮组下方16px
  - 进度条高度：4px常态，6px悬停
  - 已播放部分：主色渐变，从左到右渐变
  - 未播放部分：薄雾灰(#E8E8EE)
  - 拖动手柄：圆形，12px直径，主色深，悬停放大至14px
  - 时间显示：两侧小字(12px)，青石灰色

**右侧：辅助控制**
- 宽度：20%，最小180px
- 布局：水平排列，控件间距16px
- 音量控制：
  - 图标：扬声器图标，静音时显示禁音图标
  - 滑动条：垂直弹出，样式与进度条统一
  
- 播放模式：
  - 循环图标：显示当前模式（单曲、列表、随机）
  - 点击切换：切换时图标旋转过渡
  
- 播放列表：
  - 图标：列表图标
  - 悬停提示：显示当前队列中歌曲数
  - 点击效果：从底部滑出播放队列面板

**迷你模式：**
- 触发：窗口过窄或用户手动最小化
- 高度：缩减至56px
- 内容：仅保留封面、标题、播放/暂停按钮和简化进度条
- 展开按钮：向上箭头，点击恢复完整模式

以上设计注重用户体验、美观和实用性，同时保持与B站风格的一致性，让用户感到熟悉且易于使用。

### 5.4 辅助页面与特殊组件设计

#### 弹出式页面设计

**设置页面：**
- 触发方式：点击主界面右上角设置图标
- 弹出方式：从右侧滑入，宽度320px
- 背景效果：半透明遮罩层覆盖主界面(rgba(0,0,0,0.3))
- 页面分区：
  - 顶部：标题栏"设置"，关闭按钮
  - 中部：选项卡式内容区，包含"常规"、"播放"、"外观"、"高级"等标签
  - 底部：重置按钮和保存按钮
- 交互效果：
  - 选项卡切换时的平滑滑动效果
  - 设置项更改时的实时视觉反馈
  - 保存按钮点击后的成功动画

**播放队列面板：**
- 触发方式：点击播放控制栏的播放列表图标
- 弹出方式：从底部弹出，高度不超过屏幕的70%
- 标题区：显示"播放队列"，右侧有关闭按钮和清空按钮
- 列表区：当前播放队列中的歌曲，当前播放项高亮
- 操作功能：
  - 拖拽排序，带有平滑动画
  - 删除单曲
  - 点击播放特定歌曲
- 底部信息：显示队列总曲目数和总时长

**搜索结果页：**
- 过渡方式：从右侧滑入，替换主内容区
- 搜索框：顶部固定，自动聚焦，带有清除按钮
- 分类标签：可按"歌曲"、"歌单"、"UP主"筛选结果
- 结果展示：
  - 网格式布局，响应式调整列数
  - 卡片式设计，展示封面和关键信息
  - 分页或无限滚动加载
- 无结果状态：友好的空状态提示和建议

#### 特殊UI组件设计

**标签筛选器：**
- 形态：水平滚动条，内含多个标签胶囊
- 胶囊设计：
  - 高度28px，内边距12px
  - 圆角14px（半圆形）
  - 常态：薄边框，背景透明
  - 选中态：主色背景，白色文字
- 动画效果：选中/取消选中时的平滑过渡
- 滚动处理：两侧渐变遮罩，指示可横向滚动

**音量调节器：**
- 触发方式：点击音量图标
- 展开方向：垂直向上展开
- 设计样式：
  - 滑块轨道：高度80px，宽度4px
  - 滑块手柄：圆形，直径16px，主色深
  - 刻度标记：3个等分点，轻微凸显
- 音量级别：
  - 0%：静音图标
  - 1-33%：低音量图标
  - 34-66%：中音量图标
  - 67-100%：高音量图标
- 交互体验：实时反馈音量变化，滑动结束后平滑收起

**视觉化播放器：**
- 位置：可选在播放控制栏上方展开
- 高度：220px，全宽
- 视觉效果：
  - 频谱分析：柱状可视化，使用主色渐变
  - 波形图：平滑曲线，半透明填充
  - 粒子效果：随音乐节奏变化的动态粒子
- 背景处理：磨砂玻璃效果，或当前歌曲封面的模糊放大效果
- 切换动画：展开/收起时的平滑过渡

**通知提示：**
- 位置：右上角悬浮
- 外形：圆角矩形(8px)，宽度280px
- 层级：最高层级，确保始终可见
- 类型：
  - 成功：绿色指示条，带有勾选图标
  - 信息：主色指示条，带有信息图标
  - 警告：橙色指示条，带有感叹号图标
  - 错误：红色指示条，带有错误图标
- 动画：从右侧滑入，保持3秒，然后淡出
- 交互：点击可立即关闭

#### 特殊状态与场景

**首次使用引导：**
- 触发：首次打开插件
- 形式：叠加式引导层，半透明背景
- 步骤指示：
  - 圆形数字标记每个步骤
  - 聚焦区域高亮，其余区域减淡
  - 解释文本简洁明了，使用友好语气
- 控制按钮：
  - "下一步"：主色按钮，圆角设计
  - "跳过"：文字链接，位于右上角
  - "完成"：最后一步显示，主色按钮

**数据加载状态：**
- 加载动画：
  - 轻量级加载：原位小型旋转动画，不阻塞UI
  - 全页面加载：居中的脉动加载图标，半透明背景覆盖
- 骨架屏：
  - 内容加载中显示内容轮廓
  - 使用淡灰色(#F0F0F0)填充
  - 加入微妙的闪烁动画(shimmer)
- 过渡效果：
  - 加载完成后的淡入效果(200ms)
  - 骨架屏到实际内容的平滑过渡

**错误状态：**
- 轻微错误：底部弹出简短提示，3秒后自动消失
- 操作错误：内联显示，靠近错误来源位置
- 系统错误：
  - 模态对话框，半透明背景遮罩
  - 错误图标和说明文字
  - "重试"和"关闭"按钮
  - 可选的"报告问题"链接

**空状态设计：**
- 新建歌单：
  - 中央大型插图，音符和加号组合
  - 引导文字"开始添加您喜欢的B站音频"
  - 大号强调按钮"浏览B站发现音乐"
- 搜索无结果：
  - 简约插图，放大镜和问号
  - 友好提示"未找到匹配结果"
  - 建议文字"尝试其他关键词或浏览推荐内容"
- 播放历史为空：
  - 时钟与音符组合插图
  - 提示文字"您的播放历史将显示在这里"
